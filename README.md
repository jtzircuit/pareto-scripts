# Pareto Vault Monitoring

This repository contains utilities for tracking the share price of an
on-chain vault/tranche contract (the Pareto AA Tranche for Rockaway X USDC
in our case) over time.  The vault issues an ERC‑20 token whose value
(`price`, `tokenPrice`, etc.) reflects underlying assets that are
managed off‑chain.

## Setup

1. Clone the repo (already done).
2. Copy the example env file and fill in your values:
   ```bash
   cp .env.example .env
   # edit .env: RPC_URL, (optional) ETHERSCAN_API_KEY, etc.
   ```
3. Install dependencies:
   ```bash
   npm install
   ```

## Backfilling price history

Run the script to generate a CSV containing `[date, block, price]` lines.

```bash
npm run backfill -- --start-date 2024-01-01 --end-date 2025-02-25 --out history.csv

# override target contract and function (e.g., AA minter proxy)
npm run backfill -- --contract-address 0x9cF358aff79DeA96070A85F00c0AC79569970Ec3 --price-fn priceAA --start-date 2025-07-18 --end-date 2026-02-26 --out test.csv
```
### Additional utility: event/address dump

A second helper (`scripts/dump-events.js`) can crawl the vault contract's
logs and extract every Ethereum address mentioned in the decoded events.
This makes it easy to spot all depositors, managers and previously unknown
participants.

```bash
node scripts/dump-events.js --start-block 24000000 --out participants.txt
```

If you have an Etherscan API key set, the script will decode events; otherwise
it falls back to a naive topic-based address extractor.
Arguments:

- `--start-date` / `--end-date`: ISO dates to define the range.
- `--start-block` / `--end-block`: alternative to specify numeric blocks.
- `--out`: output CSV filename (default: `price-history.csv`).
- `--contract-address`: optional target contract address (falls back to `CONTRACT_ADDRESS`/`VAULT_ADDRESS` from env).
- `--price-fn`: optional explicit zero-arg view function to query (e.g. `priceAA`).
- `--block-step`: optional fast sampling mode (e.g. `7200` for ~daily on mainnet).

The script will fetch the contract ABI from Etherscan if an API key
is supplied and automatically choose a view function whose name contains
"price".  If no ABI can be obtained it falls back to a tiny generic ABI
and you may have to adjust the function name manually in the file.

## Extending the script

- Add event parsing (deposits/withdrawals) and annotate the CSV.
- Store data in a database or publish to a dashboard.
- Convert to TypeScript or another language.

## Notes

- `RPC_URL` must point to a provider that has archive sync; otherwise
  historical calls will fail.
- Etherscan's rate limits may apply when fetching large date ranges.

---

*Generated by GitHub Copilot.*
